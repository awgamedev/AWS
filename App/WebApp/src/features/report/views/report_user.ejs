<div class="p-6">
  <!-- Vacation Days Info Card -->
  <div class="bg-white rounded-lg shadow border border-gray-200 p-4 mb-4">
    <h3 class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
      <i class="fas fa-umbrella-beach text-indigo-500"></i>
      <%= __('VACATION_DAYS') || 'Vacation Days' %>
    </h3>
    <div class="space-y-2">
      <div class="flex justify-between items-center text-sm">
        <span class="text-gray-600"><%= __('TOTAL') || 'Total' %>:</span>
        <span class="font-medium text-gray-800"><%= userProfile && userProfile.vacationDaysPerYear ? userProfile.vacationDaysPerYear : 20 %> <%= __('DAYS') %></span>
      </div>
      <% const totalVacation = (userProfile && userProfile.vacationDaysPerYear) ? userProfile.vacationDaysPerYear : 20; %>
      <% const usedVacation = typeof vacationDaysUsed !== 'undefined' ? vacationDaysUsed : (totalVacation - vacationDaysRemaining); %>
      <% const remainingVacation = Math.max(0, totalVacation - usedVacation); %>
      <% const barColorClass = remainingVacation > 5 ? 'bg-green-500' : (remainingVacation > 2 ? 'bg-yellow-500' : 'bg-red-500'); %>
      <% const widthPercent = Math.max(0, Math.min(100, (usedVacation / totalVacation) * 100)); %>
      <% const widthStyle = `width:${widthPercent}%`; %>
      <div class="flex items-center gap-2" aria-label="Urlaubstage Fortschritt">
        <div class="flex-1 bg-gray-200 rounded-full h-2 overflow-hidden" aria-hidden="true">
          <div class="h-full rounded-full <%= barColorClass %>" data-progress-bar data-width="<%= widthPercent %>"></div>
        </div>
        <span class="text-xs font-semibold text-gray-700">
          <%= usedVacation %>/<%= totalVacation %> <%= __('USED') || 'genutzt' %> · <%= remainingVacation %> <%= __('REMAINING') %>
        </span>
      </div>
    </div>
  </div>

  <div class="relative flex mb-4 gap-2">
    <input type="text" id="reportSearch" placeholder="<%= __('REPORT_SEARCH_PLACEHOLDER') %>" class="w-full px-4 py-2 border border-gray-300 shadow-sm rounded-l-md focus:ring-indigo-500 focus:border-indigo-500 z-10">
    <button id="open-report-modal" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-r-md -ml-px z-20">
      <span class="fas fa-plus"></span>
    </button>
  </div>

  <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg relative max-h-96 overflow-y-auto overflow-x-auto">
    <table id="reportTable" class="min-w-full divide-y divide-gray-200 responsive-table actions-last">
      <thead class="bg-gray-50 sticky top-0 z-10">
        <tr>
          <th data-column="type" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">Typ</th>
          <th data-column="start" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">Start</th>
          <th data-column="end" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">Ende</th>
          <th data-column="status" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">Status</th>
          <th data-column="description" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">Beschreibung</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
        </tr>
      </thead>
      <tbody id="reportTableBody" class="bg-white divide-y divide-gray-200">
        <% (items || []).forEach(r => { %>
          <tr data-id="<%= r._id %>" data-type="<%= r.type %>" data-start="<%= new Date(r.startDate).toLocaleDateString('de-DE') %>" data-end="<%= new Date(r.endDate).toLocaleDateString('de-DE') %>" data-status="<%= r.status %>" data-description="<%= r.description || '' %>">
            <td class="px-6 py-3 text-left text-sm font-medium text-gray-900" data-label="Typ"><%= __('REPORT_TYPE_' + r.type.toUpperCase()) %></td>
            <td class="px-6 py-3 text-left text-sm font-medium text-gray-900" data-label="Start"><%= new Date(r.startDate).toLocaleDateString('de-DE') %></td>
            <td class="px-6 py-3 text-left text-sm font-medium text-gray-900" data-label="Ende"><%= new Date(r.endDate).toLocaleDateString('de-DE') %></td>
            <td class="px-6 py-3 text-left text-sm font-medium text-gray-900" data-label="Status"><%= __('REPORT_STATUS_' + r.status.toUpperCase()) %></td>
            <td class="px-6 py-3 text-left text-sm font-medium text-gray-900" data-label="Beschreibung"><%= r.description || '' %></td>
            <td class="px-6 py-3 text-right">
              <div class="flex justify-end gap-2">
                <% if (r.status === 'pending') { %>
                  <button 
                    class="edit-report-btn inline-flex items-center px-3 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors"
                    data-id="<%= r._id %>"
                    data-type="<%= r.type %>"
                    data-start="<%= new Date(r.startDate).toISOString().substring(0,10) %>"
                    data-end="<%= new Date(r.endDate).toISOString().substring(0,10) %>"
                    data-description="<%= r.description || '' %>">
                    <span>✏️</span>
                    <span class="ml-1"><%= __('EDIT_BUTTON') %></span>
                  </button>
                <% } %>
              </div>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <script>
    // Translation data for client-side use
    window.reportTranslations = {
      types: {
        vacation: "<%= __('REPORT_TYPE_VACATION') %>",
        illness: "<%= __('REPORT_TYPE_ILLNESS') %>"
      },
      statuses: {
        pending: "<%= __('REPORT_STATUS_PENDING') %>",
        approved: "<%= __('REPORT_STATUS_APPROVED') %>",
        rejected: "<%= __('REPORT_STATUS_REJECTED') %>"
      }
    };
    // Apply dynamic widths to progress bars after DOM loads
    document.querySelectorAll('[data-progress-bar]').forEach(el => {
      const w = el.getAttribute('data-width');
      if (w !== null) {
        el.style.width = w + '%';
      }
    });
  </script>
  <script src="/js/report/report-user-script.js"></script>
</div>
