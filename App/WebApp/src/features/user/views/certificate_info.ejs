<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-4 sm:py-8 px-2 sm:px-4">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                <div class="w-full sm:w-auto">
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1">
                        <%= __('CERTIFICATE_INFO_TITLE') %>
                    </h1>
                    <p class="text-xs sm:text-sm text-gray-600"><%= __('CERTIFICATE_INFO_SUBTITLE') %></p>
                </div>
                <a href="/user/details/<%= certInfo.userId %>" 
                   class="w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-xs sm:text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50 touch-action-manipulation min-h-[40px]">
                    ‚Üê <%= __('CERTIFICATE_BACK_TO_USER') %>
                </a>
            </div>
            <div class="mt-3 p-2 bg-green-50 rounded">
                <p class="text-green-700 text-xs sm:text-sm font-semibold">
                    <%= __('CERTIFICATE_CREATED_SUCCESS') %>
                </p>
            </div>
        </div>

        <!-- Certificate Details -->
        <div class="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
            <h2 class="text-base sm:text-lg font-bold text-gray-900 mb-2">
                <%= __('CERTIFICATE_DETAILS_SECTION') %>
            </h2>
            <p class="text-xs text-gray-600 mb-3"><%= __('CERTIFICATE_ENCODED_INFO') %></p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                <div class="bg-gray-50 p-2 rounded">
                    <dt class="text-xs font-medium text-gray-500 mb-1"><%= __('CERTIFICATE_CN') %></dt>
                    <dd class="text-sm font-mono text-gray-900 break-all"><%= certInfo.certificateDetails.CN %></dd>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <dt class="text-xs font-medium text-gray-500 mb-1"><%= __('CERTIFICATE_EMAIL') %></dt>
                    <dd class="text-sm font-mono text-gray-900 break-all"><%= certInfo.certificateDetails.EMAIL %></dd>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <dt class="text-xs font-medium text-gray-500 mb-1"><%= __('CERTIFICATE_OU') %></dt>
                    <dd class="text-sm font-mono text-gray-900 break-all"><%= certInfo.certificateDetails.OU %></dd>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <dt class="text-xs font-medium text-gray-500 mb-1"><%= __('CERTIFICATE_O') %></dt>
                    <dd class="text-sm font-mono text-gray-900 break-all"><%= certInfo.certificateDetails.O %></dd>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <dt class="text-xs font-medium text-gray-500 mb-1"><%= __('CERTIFICATE_C') %></dt>
                    <dd class="text-sm font-mono text-gray-900 break-all"><%= certInfo.certificateDetails.C %></dd>
                </div>
            </div>
        </div>

        <!-- Password Section -->
        <div class="bg-red-50 border border-red-400 rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
            <h2 class="text-base sm:text-lg font-bold text-red-900 mb-2">
                <%= __('CERTIFICATE_PASSWORD_SECTION') %>
            </h2>
            <div class="bg-red-100 p-2 mb-2 rounded">
                <p class="text-red-800 font-bold text-xs sm:text-sm">
                    <%= __('CERTIFICATE_PASSWORD_WARNING') %>
                </p>
            </div>
            <p class="text-xs text-gray-700 mb-3"><%= __('CERTIFICATE_PASSWORD_INFO') %></p>
            
            <div class="bg-white p-2 rounded border border-red-300">
                <label class="block text-xs font-medium text-gray-700 mb-1">
                    <%= __('CERTIFICATE_PASSWORD_LABEL') %>
                </label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" 
                           id="cert-password" 
                           value="<%= certInfo.password %>" 
                           readonly
                           class="flex-1 px-2 py-2 text-base sm:text-lg font-mono font-bold bg-gray-100 border border-gray-300 rounded text-center select-all min-h-[40px]"
                           onclick="this.select()">
                    <button onclick="copyPassword()" 
                            class="w-full sm:w-auto px-3 py-2 bg-blue-600 text-white text-xs sm:text-sm font-semibold rounded hover:bg-blue-700 transition touch-action-manipulation min-h-[40px]">
                        <span class="hidden sm:inline"><%= __('CERTIFICATE_COPY_PASSWORD') %></span>
                        <span class="sm:hidden">Kopieren</span>
                    </button>
                </div>
            </div>

            <!-- Download Button -->
            <div class="mt-3 text-center">
                <a href="/user/<%= certInfo.userId %>/download-certificate" 
                   class="inline-flex items-center justify-center w-full sm:w-auto px-4 py-2 bg-green-600 text-white text-sm font-bold rounded hover:bg-green-700 transition touch-action-manipulation min-h-[40px]">
                    ‚Üì <%= __('CERTIFICATE_DOWNLOAD_BUTTON') %>
                </a>
            </div>
        </div>

        <!-- Email Template -->
        <div class="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
            <h2 class="text-base sm:text-lg font-bold text-gray-900 mb-2">
                <%= __('CERTIFICATE_EMAIL_TEMPLATE_SECTION') %>
            </h2>
            <p class="text-xs text-gray-600 mb-2"><%= __('CERTIFICATE_EMAIL_TEMPLATE_INFO') %></p>
            
            <button onclick="copyEmailTemplateScreenshot()"
                    class="mb-2 w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 bg-pink-600 text-white text-xs sm:text-sm font-semibold rounded hover:bg-pink-700 transition touch-action-manipulation min-h-[40px]">
                Als Screenshot kopieren
            </button>


            <div id="email-template" style="font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; line-height: 1.5; color: #374151; padding: 20px; border: 1px solid #d1d5db; background-color: #f9fafb;">

    <p style="font-size: 1.125rem; font-weight: 700;">Betreff: Dein Client-Zertifikat f√ºr sicheren Zugriff</p>

    <p style="margin-top: 1rem;">Hallo <%= certInfo.username %>,</p>

    <p>Dein pers√∂nliches **Client-Zertifikat** wurde erfolgreich erstellt. Dieses Zertifikat erm√∂glicht dir einen **sicheren Zugriff** auf unsere Systeme mittels Mutual TLS (**mTLS**) Authentifizierung.</p>

    <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 1.5rem 0;">

    <h3 style="font-size: 1.25rem; font-weight: 600; color: #1d4ed8;">üîë ZERTIFIKATSDATEI & PASSWORT</h3>
    <p>
        <strong style="font-weight: 700;">Dateiname:</strong> <%= certInfo.filename %><br>
        Die Datei ist dieser E-Mail als Anhang beigef√ºgt.
    </p>

    <div style="background-color: #ffffff; border: 1px dashed #9ca3af; padding: 1rem; margin-top: 1rem; text-align: center;">
        <p style="margin: 0; color: #4b5563;">Das Passwort zum Importieren des Zertifikats lautet:</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: #dc2626; margin: 0.5rem 0 0;"><%= certInfo.password %></p>
    </div>


    <div style="background-color: #fffbeb; border: 1px solid #fcd34d; padding: 1rem; margin-top: 1.5rem;">
        <p style="margin: 0; font-weight: 700; color: #b45309;">‚ö†Ô∏è WICHTIGER SICHERHEITSHINWEIS</p>
        <p style="margin: 0.5rem 0 0; color: #78350f;">Bitte behandle dieses Zertifikat und das zugeh√∂rige Passwort vertraulich. Teile diese Informationen niemals mit Dritten. Das Passwort wird nur einmal angezeigt und kann nicht wiederhergestellt werden.</p>
    </div>

    <div style="background-color: #fff1f2; border: 1px solid #fca5a5; padding: 1rem; margin-top: 1.5rem;">
        <p style="margin: 0; font-weight: 700; color: #dc2626;">‚ùó WICHTIG: L√∂sche diese E-Mail nach der Installation des Zertifikats aus deinem Posteingang und Papierkorb, um die Sicherheit deiner Zugangsdaten zu gew√§hrleisten.</p>
    </div>

    <hr style="border: 0; border-top: 1px solid #d1d5db; margin: 2rem 0;">

    <h2 style="font-size: 1.5rem; font-weight: 700; color: #1d4ed8;">‚öôÔ∏è INSTALLATIONSANLEITUNGEN</h2>

    <h3 style="font-size: 1.125rem; font-weight: 600; color: #3b82f6; margin-top: 1.5rem;">üñºÔ∏è INSTALLATION UNTER WINDOWS</h3>
    <ol style="list-style-type: decimal; margin-left: 1.5rem; padding-left: 0;">
        <li style="margin-bottom: 0.5rem;">Doppelklicke auf die .p12-Datei, die du als Anhang erhalten hast.</li>
        <li style="margin-bottom: 0.5rem;">Im Zertifikatimport-Assistenten w√§hle "Aktueller Benutzer" aus und klicke auf "Weiter".</li>
        <li style="margin-bottom: 0.5rem;">Best√§tige den Dateipfad der .p12-Datei und klicke erneut auf "Weiter".</li>
        <li style="margin-bottom: 0.5rem;">Gib das oben angegebene Passwort in das Eingabefeld ein.</li>
        <li style="margin-bottom: 0.5rem;">W√§hle "Alle Zertifikate in folgendem Speicher speichern", klicke auf "Durchsuchen" und w√§hle "Eigene Zertifikate" aus.</li>
        <li style="margin-bottom: 0.5rem;">Schlie√üe den Assistenten ab, indem du auf "Fertig stellen" klickst.</li>
    </ol>

    <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 1.5rem 0;">

    <h3 style="font-size: 1.125rem; font-weight: 600; color: #3b82f6;">ü§ñ INSTALLATION UNTER ANDROID</h3>
    <ol style="list-style-type: decimal; margin-left: 1.5rem; padding-left: 0;">
        <li style="margin-bottom: 0.5rem;">√úbertrage die .p12-Datei auf dein Android-Ger√§t.</li>
        <li style="margin-bottom: 0.5rem;">√ñffne die Einstellungen. Navigiere zu: **Sicherheit** ‚Üí **Verschl√ºsselung & Anmeldedaten**.</li>
        <li style="margin-bottom: 0.5rem;">Tippe auf "Zertifikat installieren" oder "Von Ger√§tespeicher installieren".</li>
        <li style="margin-bottom: 0.5rem;">W√§hle "CA-Zertifikat" oder "VPN- und App-Benutzerzertifikat" aus.</li>
        <li style="margin-bottom: 0.5rem;">Navigiere zum Speicherort der .p12-Datei und w√§hle sie aus.</li>
        <li style="margin-bottom: 0.5rem;">Gib das Passwort ein, wenn du dazu aufgefordert wirst.</li>
        <li style="margin-bottom: 0.5rem;">Vergib einen aussagekr√§ftigen Namen (z.B. "Firmen-Zugang") und best√§tige die Installation.</li>
    </ol>

    <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 1.5rem 0;">

    <h3 style="font-size: 1.125rem; font-weight: 600; color: #3b82f6;">üì± INSTALLATION UNTER iOS/iPadOS</h3>
    <ol style="list-style-type: decimal; margin-left: 1.5rem; padding-left: 0;">
        <li style="margin-bottom: 0.5rem;">Sende die .p12-Datei per E-Mail an dich selbst oder lade sie in iCloud Drive hoch.</li>
        <li style="margin-bottom: 0.5rem;">√ñffne die Datei auf deinem iOS-Ger√§t (z.B. aus der Mail-App).</li>
        <li style="margin-bottom: 0.5rem;">iOS erkennt das Zertifikat und fordert dich zur Installation auf.</li>
        <li style="margin-bottom: 0.5rem;">Gib das Passwort ein, wenn du dazu aufgefordert wirst.</li>
        <li style="margin-bottom: 0.5rem;">Gehe zu den Einstellungen deines Ger√§ts. Navigiere zu: **Allgemein** ‚Üí **VPN und Ger√§teverwaltung**.</li>
        <li style="margin-bottom: 0.5rem;">W√§hle das neu installierte Profil aus der Liste aus und tippe auf "Installieren".</li>
        <li style="margin-bottom: 0.5rem;">Gib deinen Ger√§te-Passcode ein, wenn du dazu aufgefordert wirst.</li>
        <li style="margin-bottom: 0.5rem;">Best√§tige die Installation des Zertifikats.</li>
    </ol>

    <hr style="border: 0; border-top: 1px solid #d1d5db; margin: 2rem 0;">

    <h3 style="font-size: 1.25rem; font-weight: 600; color: #1d4ed8;">‚ùì SUPPORT</h3>
    <p>Bei Fragen oder Problemen w√§hrend der Installation wende dich bitte an den Support.</p>

    <p style="margin-top: 1.5rem;">Mit freundlichen Gr√º√üen,<br>
    <strong style="font-weight: 700;"><%= user && user.displayName ? user.displayName : (user && user.username ? user.username : '') %></strong></p>

</div>
        </div>
    </div>
</div>

<script>
function copyPassword() {
    const passwordInput = document.getElementById('cert-password');
    passwordInput.select();
    document.execCommand('copy');
    
    // Show feedback
    alert('<%= __("CERTIFICATE_PASSWORD_COPIED") %>');
}

// Auto-select password on page load for easy copying
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('cert-password');
    passwordInput.focus();
    passwordInput.select();
});

// Copy email template as screenshot to clipboard
async function copyEmailTemplateScreenshot() {
    const el = document.getElementById('email-template');
    if (!el) return;
    html2canvas(el, {backgroundColor: null, scale: 2}).then(async canvas => {
        canvas.toBlob(async function(blob) {
            if (navigator.clipboard && window.ClipboardItem) {
                try {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    alert('Screenshot wurde in die Zwischenablage kopiert!');
                } catch (err) {
                    alert('Kopieren als Bild nicht unterst√ºtzt: ' + err);
                }
            } else {
                alert('Kopieren als Bild wird von diesem Browser nicht unterst√ºtzt.');
            }
        }, 'image/png');
    });
}
</script>


