<%
// Helper: generate dropdown option markup
const generateTaskOptions = (users, priorityList, __) => {
    const userOptions = users
        .map(u => `<option value="${u._id}">${u.username}</option>`)
        .join("");
    const priorityOptions = priorityList
        .map(p => `<option value="${p}">${__("PRIORITY_" + p.toUpperCase()) || p}</option>`)
        .join("");
    return { userOptions, priorityOptions };
};

const { userOptions, priorityOptions } = generateTaskOptions(users, ["low","medium","high"], __);
const fieldClass = "mt-1 block w-full border border-gray-300 rounded-md bg-white shadow-sm px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition";
const labelClass = "block text-xs font-semibold tracking-wide text-gray-600 uppercase";
%>

<form id="create-task-form" class="space-y-4">
    <div class="max-h-[28rem] overflow-y-auto pr-1 space-y-6">
        <!-- Template Selector (new addition) -->
        <div>
            <label for="templateSelector" class="<%= labelClass %>"><%= __("USE_TEMPLATE_LABEL") || "Use Template" %></label>
            <select id="templateSelector" name="templateSelector" class="<%= fieldClass %>">
                <option value=""><%= __("SELECT_TEMPLATE_DEFAULT") || "-- No Template --" %></option>
            </select>
        </div>

        <!-- Top grouping: Name spans full width -->
        <div class="grid gap-6 md:grid-cols-3">
            <div class="md:col-span-3">
                <label for="taskName" class="<%= labelClass %>"><%= __("TASK_NAME_LABEL") %> *</label>
                <input type="text" id="taskName" name="taskName" required autocomplete="off" maxlength="120" placeholder="" class="<%= fieldClass %>" autofocus>
            </div>
            <div>
                <label for="userId" class="<%= labelClass %>"><%= __("ASSIGN") %></label>
                <select id="userId" name="userId" class="<%= fieldClass %>">
                    <option value=""><%= __("SELECT_DEFAULT") %></option>
                    <%- userOptions %>
                </select>
            </div>
            <div>
                <label for="taskPriority" class="<%= labelClass %>"><%= __("PRIORITY") %> *</label>
                <select id="taskPriority" name="taskPriority" class="<%= fieldClass %>">
                    <%- priorityOptions %>
                </select>
            </div>
            <div class="grid grid-cols-2 gap-6 md:col-span-3">
                <div>
                    <label for="startDate" class="<%= labelClass %>"><%= __("START_DATE_LABEL") %> *</label>
                    <input type="date" id="startDate" name="startDate" required class="<%= fieldClass %>">
                </div>
                <div>
                    <label for="endDate" class="<%= labelClass %>"><%= __("END_DATE_LABEL") %></label>
                    <input type="date" id="endDate" name="endDate" class="<%= fieldClass %>">
                </div>
            </div>
        </div>

        <!-- Description full width -->
        <div>
            <label for="taskDescription" class="<%= labelClass %>"><%= __("DESCRIPTION_LABEL") %></label>
            <textarea id="taskDescription" name="taskDescription" rows="4" maxlength="1000" placeholder="" class="<%= fieldClass %> resize-y"></textarea>
        </div>

        <div id="task-form-message" class="hidden text-sm font-medium text-center px-3 py-2 rounded-md"></div>
    </div>

    <div class="flex items-center justify-end gap-3 pt-2">
        <button type="submit" class="inline-flex items-center gap-2 rounded-md bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <span><%= __("SAVE_TASK_BUTTON") %></span>
        </button>
    </div>
</form>