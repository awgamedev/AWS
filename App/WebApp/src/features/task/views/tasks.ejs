<%
const getStatusLabel = (status) => {
    switch (status) {
      case "pending": return __("STATUS_PENDING");
      case "in-progress": return __("STATUS_IN_PROGRESS");
      case "completed": return __("STATUS_COMPLETED");
      default: return status;
    }
};

const createTaskTitle = __("CREATE_NEW_TASK");
%>

<div>
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 mb-1">
        <div class="flex items-center justify-between sm:justify-start gap-1">
            <button id="prev-week" class="px-2 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg shadow hover:bg-gray-300 transition duration-150 flex items-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            
            <div class="flex-1 sm:flex-none text-center">
                <p class="text-base md:text-lg text-gray-800 font-semibold" id="current-week-range"><%= weekRange %></p>
                <p class="text-xs text-gray-500" id="week-offset-display"></p>
            </div>
            
            <button id="next-week" class="px-2 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg shadow hover:bg-gray-300 transition duration-150 flex items-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>
        
        <div class="w-full sm:w-auto sm:ml-auto flex flex-row items-stretch items-center gap-1 sm:gap-3">
            <!-- <button id="switch-to-list-view" class="text-[22px] sm:text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 focus:ring-2 focus:ring-gray-400 focus:outline-none touch-manipulation flex items-center justify-center">
                <span class="inline-block sm:hidden"><i class="fa fa-list"></i></span>
                <span class="hidden sm:inline"><%= __('SWITCH_TO_LIST_VIEW') %></span>
            </button> -->
            <button id="open-task-modal" class="px-2 py-0 sm:py-2 text-[22px] sm:text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:outline-none touch-manipulation flex items-center justify-center">
                <%= __("CREATE_TASK_BUTTON") %>
            </button>
            <button id="today-week" class="px-2 py-0 sm:py-2 text-[22px] sm:text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 focus:ring-2 focus:ring-gray-400 focus:outline-none touch-manipulation flex items-center justify-center">
                <span class="inline-block sm:hidden"><i class="fa fa-calendar-week"></i></span>
                <span class="hidden sm:inline">
                    <%= __("THIS_WEEK") %>
                </span>
            </button>
            <!-- Manual button: always a button, book icon, label hidden on mobile -->
            <button id="manual-toggle" type="button" class="px-2 py-0 sm:py-2 flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 text-blue-700 rounded transition duration-200 border border-blue-100 focus:outline-none" title="<%= __('SHOW_MANUAL') %>">
                <i class="fas fa-book-open"></i>
            </button>
        </div>
    </div>
</div>

<!-- Collapsible Manual (hidden by default, shown on mobile, toggled by button) -->
<div class="mb-1 bg-white rounded-lg shadow-md overflow-hidden">
    <div id="manual-content" class="px-4 py-4 bg-white border-t border-gray-200 hidden">
        <div class="prose prose-sm max-w-none text-gray-700">
            <!-- ...manual content unchanged... -->
            <h3 class="text-lg font-bold text-indigo-700 mb-3 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                Übersicht
            </h3>
            <p class="mb-4">
                Diese Seite ist ein <strong>Aufgabenplaner</strong>, der Aufgaben nach <strong>Mitarbeitern</strong> und <strong>Wochentagen</strong> organisiert. 
                Sie können Aufgaben erstellen, bearbeiten, zuweisen, verschieben und deren Status verwalten. Die Ansicht zeigt eine wochenbasierte 
                Übersicht aller Aufgaben im Team.
            </p>
            <!-- ...rest of manual content unchanged... -->
        </div>
    </div>
</div>

<div id="task-content-container" class="flex-1 min-h-0 overflow-y-auto">
    <!-- Initial view: task board -->
    <div class="task-board-content">
        <%- include('./task_board_content.ejs', { users, tasksByDayAndUser, daysOfWeek, __: __ }) %>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 shadow-xl">
        <div class="flex items-center space-x-3">
            <svg class="animate-spin h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-gray-700 font-medium"><%= __("LOADING") || "Loading..." %></span>
        </div>
    </div>
</div>

<script>
    window.CREATE_MODAL_TITLE = "<%= createTaskTitle %>";
    window.CURRENT_WEEK_OFFSET = "<%= typeof weekOffset !== 'undefined' ? weekOffset : 0 %>";
    window.taskTranslations = {
        viewSwitch: {
            list: "<%= __('SWITCH_TO_LIST_VIEW') %>",
            board: "<%= __('SWITCH_TO_BOARD_VIEW') %>"
        },
        unassigned: "<%= __('UNASSIGNED') %>",
        cancel: "<%= __('CANCEL') %>",
        dragConfirmTitle: "<%= __('DRAG_CONFIRM_TITLE') %>",
        dragTask: "<%= __('DRAG_TASK') %>",
        dragUser: "<%= __('DRAG_USER') %>",
        dragStartDate: "<%= __('DRAG_START_DATE') %>",
        dragEndDate: "<%= __('DRAG_END_DATE') %>",
        dragConfirmButton: "<%= __('DRAG_CONFIRM_BUTTON') %>",
        dragMoving: "<%= __('DRAG_MOVING') %>",
        contextMenuChangePriority: "<%= __('CONTEXT_MENU_CHANGE_PRIORITY') %>",
        contextMenuDeleteTask: "<%= __('CONTEXT_MENU_DELETE_TASK') %>",
        contextMenuPriorityHigh: "<%= __('CONTEXT_MENU_PRIORITY_HIGH') %>",
        contextMenuPriorityMedium: "<%= __('CONTEXT_MENU_PRIORITY_MEDIUM') %>",
        contextMenuPriorityLow: "<%= __('CONTEXT_MENU_PRIORITY_LOW') %>",
        confirmDeleteTask: "<%= __('CONFIRM_DELETE_TASK') %>",
        unassignedTaskDetails: "<%= __('UNASSIGNED_TASK_DETAILS') %>",
        assignToMe: "<%= __('ASSIGN_TO_ME') %>",
        assigning: "<%= __('ASSIGNING') %>",
        assignToYourselfMessage: "<%= __('ASSIGN_TO_YOURSELF_MESSAGE') %>",
        dateRange: "<%= __('DATE_RANGE') %>"
    };

    // Manual toggle functionality (hidden by default on all devices)
    document.addEventListener('DOMContentLoaded', function() {
        const manualToggle = document.getElementById('manual-toggle');
        const manualContent = document.getElementById('manual-content');
        if (manualToggle && manualContent) {
            manualToggle.addEventListener('click', function() {
                manualContent.classList.toggle('hidden');
            });
        }
    });
</script>

<script src="/js/task/task-combined-script.js"></script>
